<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.gd.safari.mapper.ITaskCommentMapper">
	<!-- 업무 코멘트리스트 가져오기 -->
	<select id="selectTaskComment" parameterType="int" resultType="map">
		SELECT 
			tc.task_cmt_no			taskCmtNo
			, tc.task_cmt_content	taskCmtContent
			, tc.create_date		createDate
			, tc.task_cmt_upper_no	taskCmtUpperNo
			, wm.work_member_name	workMemberName
		FROM 
			task_comment tc 				INNER JOIN task t
		ON 
			tc.task_no = t.task_no 			INNER JOIN task_list tl
		ON 
			t.tasklist_no = tl.tasklist_no 	INNER JOIN project p 
		ON 
			tl.project_no = p.project_no 	INNER JOIN workspace_member wm
		ON 
			p.work_no = wm.work_no
		WHERE 
			wm.work_member_email = tc.task_cmt_writer
		AND 
			tc.task_no = #{taskNo}
		ORDER BY
			tc.create_date DESC
	</select>
	<!-- 수정하기 위한 업무 코멘트 가져오기 -->
	<select id="selectTaskCommentByTaskCmtNo" parameterType="int" resultType="map">
		SELECT 
			tc.task_cmt_no			taskCmtNo
			, tc.task_cmt_content	taskCmtContent
			, tc.create_date		createDate
			, tc.task_cmt_upper_no	taskCmtUpperNo
			, wm.work_member_name	workMemberName
		FROM 
			task_comment tc 				INNER JOIN task t
		ON 
			tc.task_no = t.task_no 			INNER JOIN task_list tl
		ON 
			t.tasklist_no = tl.tasklist_no 	INNER JOIN project p 
		ON 
			tl.project_no = p.project_no 	INNER JOIN workspace_member wm
		ON 
			p.work_no = wm.work_no
		WHERE 
			wm.work_member_email = tc.task_cmt_writer
		AND 
			tc.task_cmt_no = #{taskCmtNo}
	</select>
	<!-- 업무 코멘트 생성 -->
	<insert id="insertTaskComment" parameterType="com.gd.safari.vo.TaskComment">
		INSERT INTO task_comment (
			task_no
			, task_cmt_content
			, task_cmt_writer
			, task_cmt_fix
			, create_date
			, update_date
			, task_cmt_upper_no
		) VALUES (
			#{taskNo}
			, #{taskCmtContent}
			, #{taskCmtWriter}
			, 'N'
			, NOW()
			, NOW()
			, NULL
		)
	</insert>
	<!-- 업무 코멘트 수정 -->
	<update id="updateTaskComment" parameterType="com.gd.safari.vo.TaskComment">
		UPDATE task_comment
		SET
			task_cmt_content = #{taskCmtContent}
			, update_date = NOW()
		WHERE
			task_cmt_no = #{taskCmtNo}
	</update>
	<!-- 업무 코멘트 삭제 -->
	<delete id="deleteTaskComment" parameterType="int">
		DELETE FROM task_comment
		WHERE 
			task_cmt_no = #{taskCmtNo}
	</delete>
</mapper>